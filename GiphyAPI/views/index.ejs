<%- include("partials/header") %>
<!-- TODO disable the like functionality, or resend the user to sign up / login when the button is hit... and they are not signed in currently -->

            <% if (favorites) { %>
                <h1>Favorites</h1>
                <section id="favoriteContainer">
                    <% for (const section of favorites) { %>
                        <div class="indiv">
                            <img src="<%=section.url%>" alt="" style="height=<%=section.height%> width=<%=section.width%>%>">
                            <section class="information" style="height: <%=section.height%>; width:<%=section.width%>">
                                <h4><%=section.title%></h4>
                                <button class="liked" name=<%=section._id%> onclick="like(this)"><3</button>
                            </section>
                        </div>
                    <% } %>
                </section>
            <% } else { %>
                <h1>Giphy Daily Project.</h1>
                <input type="text" name="title" placeholder="Type here..." required>
                <button type="submit">Search</button>

                <!-- gifs are going to go here -->
                <section id="result">
                    <%  if (result) { %>
                        <% for (const section of result) { %>
                            <div class="indiv">
                                <img src="<%=section.imageUrl%>" alt="" style="height=<%=section.imageHeight%> width=<%=section.imageWidth%>%>">
                                <section class="information" style="height: <%=section.imageHeight%>; width:<%=section.imageWidth%>">
                                    <h4><%=section.gifTitle%></h4>
                                    <button class="<%=section.checked ? 'liked' : '' %>" name="<%=section.id%>" onclick="like(this)"><3</button>
                                </section>
                            </div>
                        <% } %>
                    <%  } else { %>
                        <!-- <h3>Nothing is being showed......</h3> -->
                    <%  } %>
                </section>
            <% } %>
        </main>

        <script>

            ////////// containers
            const resultContainer = document.querySelector("#result");
            const favoriteContainer = document.querySelector("#favoriteContainer");
            const individuals = document.querySelectorAll(".indiv");

            //////////// Query form
            const query = document.querySelector("input[type=text]");
            const queryButton = document.querySelector("button[type=submit]");
            if (query)
            {
                queryButton.addEventListener("click", function(){
                    console.log(query.value);
                });
            }

            for (const indiv of individuals)
            {
                indiv.addEventListener("mouseenter", function(){
                    this.children[1].style.visibility = "visible";
                });
                indiv.addEventListener("mouseleave", function(){
                    this.children[1].style.visibility = "hidden";
                });
            }

            const sections = document.querySelectorAll(".column");
            // for trending, put trending past the / mark 
            function getGifs(trending)
            {
                let look = "/getSomething/trending"; 
                if (!trending)
                {
                    look = "/getSomething/" + query.value;
                }
                else
                {
                    console.log("Going to look for trending things!");
                }

                // fetch("/getSomething/trending")
                fetch(look)
                .then( (r)=>r.json() )
                .then( (r) => {
                    const array = r.result;
                    for (const gif in array)
                    {
                        // stores the current gif
                        const current = array[gif];
                        console.log(current);

                        //// container div
                        const div = document.createElement("div");
                        div.classList.add("indiv");
                        ////// image
                        const image = document.createElement("img");
                        image.src = current.url;
                        image.style.height = current.height;
                        image.style.width = current.width;
                        ////// section .information 
                        const sectionInformation = document.createElement("section");
                        sectionInformation.classList.add("information");
                        sectionInformation.style.height = current.height;
                        sectionInformation.style.width = current.width;
                        ////// section h4
                        const h4 = document.createElement("h4");
                        h4.innerText = current.title;
                        //////// section button
                        const button = document.createElement("button");
                        button.innerText = "<3";
                        button.name = current.id;

                        if (current.checked)
                        {
                            button.classList.add("liked");
                        }

                        button.addEventListener("click", function(){
                            // if the button is liked currently, remove it from the database, and webpage
                            if (this.classList.contains("liked"))
                            {
                                fetch("/removeFavorite", {
                                    method: "POST",
                                    headers: new Headers({
                                        "content-type": "application/json"
                                    }),
                                    body: JSON.stringify({
                                        // gif_id, is the id in the database, helps identify what to remove from the database 
                                        gif_id: current.id
                                    })
                                })
                                .then((r)=>{
                                    // removing from the container, so it does not show on the screen, without reloading the page.
                                    favoriteContainer.removeChild(this.parentElement.parentElement);
                                })
                                .catch(e=>console.log("Error"));
                            }
                            else
                            {
                                // not liked, make it liked
                                obj.classList.toggle("liked");

                                // adding to our favorites
                                fetch("/favorite", {
                                    method: "POST",
                                    headers: new Headers({
                                        "content-type": "application/json"
                                    }),
                                    body: JSON.stringify(current)
                                })
                                .then((r)=>{
                                    console.log(r.status);
                                    // could not complete this transaction
                                    if (r.status == 409)
                                    {
                                        console.error("Could not add to favorites");
                                    }
                                    else
                                    {
                                        console.log("Added to the favorites.");
                                    }
                                })
                                .catch(e=>console.log("Error..."))
                            }
                        });
                    } // end of for
                }).catch(e=>console.log("error", e));
            }

            if (document.location.pathname === "/")
            {
                getGifs(true);
            }

        </script>
    </body> 
</html>